# JavaScript的基础语法

> 基础不牢，地动山摇。—— 某高中数学老师

## 序言

“给我去学JavaScript语法！”

这是无名杀圈子里，熟悉代码的老手对于部分新手经常说的一句话。90%的问题可以在熟练了JavaScript语法后得到解释，而不熟悉语法的萌新通常会把本体中武将的技能代码按自己的理解随意挪用缝合，导致一些离谱至极的东西出现，甚至让人都懒得吐槽。

不客气的说，任何跳过基础语法而教你写技能的教程，都是在促使这种烦人萌新的出现，除非他们注明阅读教程需要JavaScript基础。

然而，也可以理解。网络上大多数JavaScript语法的弱保软教程，都是基于网页框架的。这就会让只对无名杀感兴趣的初学者一头雾水。他们可能需要手动建一个网页才能看到代码的实际效果。我们不需要，我们直接用上个章节我们制作的扩展进行修改。

本章节大量参考和引用了[菜鸟教程](https://www.runoob.com/js/js-syntax.html)中关于JavaScript语法的章节，如果你嫌后面太长，也可以直接看这个。

## 字面量

在计算机科学中，字面量是用于表达源代码中一个固定值的表示法（通俗称呼为“常量”，本教程里可能同时使用这两种称呼）。可能这样的定义让你感到疑惑，不要紧，我们来举例说明。

### 数字

数字字面量，可以是整数（包括正数、负数和0）或者是小数，或者是科学计数(e)，例如：

```
2.73
114514
191e5 
-2
```

此外，还有一些特殊的数字字面量，例如：
```JavaScript
NaN //表示一个“不是数”的数字字面量。当我们进行非法的字符转换数字时，会得到这个数。
Infinity //表示“无穷大”。
```

在第一章的教学中，我们看到过如下代码：

```JavaScript
        character:{
            'jxkz_pamu':['male','shu',5,['jxkz_shuohua','jxkz_baoyuan'],['des:列车长。']],
        },
```

这里的```5```就是一个数字字面量。

（后面我们可能要多次提到这段代码，为了避免多次贴代码的重复引用，以下称呼这段代码为**角色信息代码**。）

### 字符串

字符串（String）字面量表示一段字符。在代码中，用双引号或者单引号括起来的部分就是字符串字面量，例如：

```JavaScript
"hello"
'hello noname'
"你好"
```

没有任何字符的字符串，也是一个字符串，我们称呼为空字符串，可以表示为```""```或者```''```。

如果我们需要在字符串中包含引号，可以有两种方式。如果字符串里仅包含单引号或者只包含双引号，那么包含单引号的字符串我们用双引号囊括，包含双引号的字符串我们用单引号囊括即可：

```JavaScript
"This is a 'demo'."
'This is a "demo" too.'
```

还有一种方式是在单/双引号前添加转义符号```\```。

```JavaScript
"This is a \"demo\""
'Do you know this \'demo\'?'
```

请注意：除了需要显示的字符串内之外，我们在程序代码中使用的标点符号均为半角符号，例如：

```
,.()[];:""''^&
```

在输入这些符号时，请确保你的输入法处于英文状态。全角符号（也称“中文标点”），例如```，。；：“”‘’```等，在程序代码里是会造成语法错误的。

在**角色信息代码**中，我们可以看到大量的用```''```和```""```囊括的字符串。在上个章节的技能代码实现里，也包含一个关键的字符串：

```JavaScript
            'jxkz_shuohua':{
                enable:'phaseUse',
                content:function(){
                    player.say("你好，无名杀！");
                }
            },
```

如果我们把这段代码里的```你好，无名杀！```修改为其它内容，就可以在游戏中，让角色说出不同的话语。

![字符串示范](1.jpg)

### 布尔值

布尔值，也可以叫“是非值”，即为```true```和```false```，含义分别为“是”和“否”。用来表达某些非常明确的二元逻辑。

```JavaScript
true
false
```

### 数组

如果我们要表示一个或多个数，我们可以使用数组（Array）字面量，例如：

```JavaScript
[1,2,3,4,5,6,7]
[1,1,4,5,1,4]
[1.1,4.51,4.19,19.8,10]
```

虽然名为“数组”，但其内容并不仅限于数字。任何量都可以填入数组中，例如：

```JavaScript
['全体目光向我看齐',"看我看我",'我宣布个事儿',"我是个数组！",666,666]
```

### 对象

对象（Object）是编程语言中的一个概念。在现实中，它的定义为“具体的某一个事物”，在编程语言里，可以理解为“具有某些属性，且可以对其进行某些操作的一个实体”。

我们可以写一个对象字面量：

```JavaScript
{
    name:"坤坤",
    practiseTime:2.5,
    hobbies:["唱","跳","RAP","篮球"],
    skills:["铁山靠"],
    music:"只因你太美.mp3"
}
```

对象字面量可以嵌套对象字面量，就像这样：

```JavaScript
{
    name:"坤坤",
    practiseTime:{
        value:2.5,
        unit:'年',
    },
    hobbies:["唱","跳","RAP","篮球"],
    skills:["铁山靠"],
    music:"只因你太美.mp3"
}
```

在扩展中，我们可以看到大量的对象字面量，用```{}```囊括，且内部包含多个```key:value```键值对形式。每个键值对都以```,```结尾，最后一个键值对前的```,```可以省略。

注意，不是所有```{}```包括的都是对象字面量，请注意其具体形式和上下文。举例：

```JavaScript
function(){

}
//这是函数字面量。
()=>{

}
//这也是函数字面量。
for(var i=0;i<100;i++){
    alert("你好");
}
//这是for循环语句。
"{}"
//这是字符串。
```

```{}```是一对经常使用的符号。后面我们会逐渐熟悉它的作用。

### 函数

函数[^函数]（function），指具有特定作用的代码块，这里只做简单介绍，之后会详细说明。以下是一些函数字面量的范例：

[^函数]: 函数（function）有时也可以称呼为方法（method），后者在面向对象相关会频繁提到，本教程出于习惯，可能会同时使用这两种叫法。

```JavaScript
function(event,player){
    return player.hp <= 4;
}
//普通函数。

(item)=>item.name != param.name;
//箭头函数。

```

在以下技能代码中，```content```后面的部分就是一个函数字面量。

```JavaScript
            'jxkz_baoyuan':{
                trigger:{
                    player:'damageEnd',
                },
                content:function(){
                    player.say('你干嘛哈哈哎呦');
                }
            }
```

## 变量

关于字面量，我们已经有了一个大致的了解，下面介绍一个新概念：变量。

变量，顾名思义，意思为“可变的量”。如果你有初高中数学的基础，你应该明白表达式中未知数```x```的概念。

在JavaScript中，我们用```var```或```let```[^let]关键字[^关键字]来声明变量。关于```var```与```let```的区别，后面会讲述。

范例：

[^let]: 现代JavaScript一般推荐使用```let```这种定义域明确的关键字声明变量。然而由于某些特殊的原因，技能代码中使用```let```关键字会导致兼容版无名杀报错。（无名杀新版本的生成器函数特性解决了这个问题，本教程将优先教生成器函数的技能编写方式）鉴于兼容版用户极少，本教程后面的范例代码将兼用```var```与```let```。

[^关键字]: 在代码中具有特殊意义的某些单词。任何变量不得使用关键字进行命名。

```JavaScript
var m = 3;
let p = 2;
var str = "你好";
```

在第一章的教学代码里，我们可以把技能代码改写成如下形式：

```JavaScript
            'jxkz_shuohua':{
                enable:'phaseUse',
                content:function(){
                    let str = "你好，无名杀！";
                    player.say(str);
                }
            },
```

先声明了一个叫```str```的变量，为其赋初值为字符串```"你好，无名杀！"```，后面再使用这个变量。

变量的值可以被改变，例如：

```JavaScript
            'jxkz_shuohua':{
                enable:'phaseUse',
                content:function(){
                    let str = "你好，无名杀！";
                    player.say(str);
                    str = "你干嘛哈哈";
                    player.say(str);
                }
            },
```

执行后我们发现，两次```say```访问的```str```显示的实际字符串不一样，这就是因为中途其数值被改变了。

仅仅使用过C++、Java之类的语言的读者可能会感到困惑，为什么这里没有声明变量的类型。这是因为JavaScript并不会对变量的类型作限制。某个变量可能之前是一个字符串，后面就变成了一个数字，再后面变成了一个函数。

```JavaScript
let val = "你好";//变量val是字符串。
val = 3.14;//现在它是数字。
val = ()=>{return "你好";};//现在它是函数。
```

我们可以一次性声明多个变量：

```JavaScript
let name = "坤坤",year = 2.5;//声明了两个变量，name和year，并分别为其赋值。
```

变量声明时并不需要赋值，可以先声明变量，然后在后面使用前再为其赋值。

```JavaScript
var name,year;//声明变量
let hobby;//声明变量

name = "坤坤";//赋值
year = 2.5;//赋值
hobby = ['唱','跳','RAP','篮球'];//赋值
```

这里的```=```是“赋值操作符”。意为将```=```右边部分的值赋予左边的变量。

```JavaScript
let a = "甲",b = "乙";//声明两个变量，并赋值。
b = a;//将变量a的值赋给变量b。
player.say(b);//此时显示b的值，我们发现变成了“甲”。
```

```=```右边可以为常量或变量，等号左边只能是一个变量。

```JavaScript
let a = "甲",b = "乙";//声明两个变量，并赋值。
b = a;//可行的操作，将变量a的值赋予变量b。

"乙" = a;//不可行的操作，左边是一个常量，是不能被赋值的。
```

如果一个变量声明后未曾赋值，那么它将有一个特殊的值，为```undefined```，意思是“未定义”。这是JavaScript程序大量错误的来源。

我们可以使用```const```关键字主动声明一个有名字的常量，对其进行任何修改都属于错误，会被调试器警告，并无法顺利运行。

```JavaScript
const PI = 3.141592653589;
let a = PI;//可行。
let b;
b = PI;//可行。
PI = 666;//不可行，常量不能被修改。
```

## 操作符

当我们还是小学生的时候，我们就熟练掌握了四则运算的规则[^四则运算]，知道加减乘除的含义。这些珍贵的知识不仅在买菜时用到。在编程语言中，我们也需要用操作符来告诉程序需要执行哪些运算。下面将简单介绍一些常用的操作符。

[^四则运算]: 没有掌握的去看[这个](http://www.dzkbw.com/books/rjb/xiaoxue-shuxue/)。

### 赋值操作符（=）

赋值操作符```=```，我们在刚才关于“变量”的段落中，其实已经讲解了它的作用。它可以改变一个变量的值。例如：

```JavaScript
let a = "123";
a = "456";
player.say(a);//显示456
```

这里就不再赘述。此外我们介绍一种赋值的方式，这是JavaScript的ES6标准新增的方法，称为“解构赋值”。

```JavaScript
let a,b,c;
[a,b,c] = [1,2,3];
```

这种赋值方式和下面的语句等同：

```JavaScript
let a,b,c;
a = 1;
b = 2;
c = 3;
```

这里仅介绍解构赋值最简单的用法，感兴趣的朋友可参考[其它资料](https://www.jb51.net/article/229164.htm)。

### 加法操作符（+）

加法操作符```+```可以运算两个数字变量的和，示例：

```JavaScript
let a = 3+2;
player.say(a);//显示5。
```

注意：涉及到浮点数[^浮点数]的运算很可能存在误差。出现例如```0.1+0.2```等于```0.30000000000000004```的结果。[参考资料：javascript语言数字运算缺陷](https://zhuanlan.zhihu.com/p/90803697)。

[^浮点数]: 小数。

加法操作符不仅能够运算两个数字变量的和，还能被用来拼接字符串，如：

```JavaScript
let year = 2.5;
let str = "我是练习时长"+year+"年的个人练习生。";

let [sing,dance,rap,basketball] = ["唱","跳","RAP","篮球"];
let str2 = "喜欢"+sing+"、"+dance+"、"+rap+"、"+basketball+"。";

player.say(str+str2);//显示“我是练习时长2.5年的个人练习生。喜欢唱、跳、RAP、篮球。”

```

### 减法操作符（-）

减法操作符```-```可以运算两个数字变量的差，示例：

```JavaScript
let a = 9-3;
player.say(a);//显示6。
```

注意：减法操作符并不能用来裁剪字符串。

### 乘法操作符（*）

乘法操作符```*```可以运算两个数字变量的乘积，示例：

```JavaScript
let a = 3*7;
player.say(a);//显示21。
```

### 除法操作符（/）

除法操作符```/```可以运算两个数字变量的商，示例：

```JavaScript
let a = 4/2;
player.say(a);//显示2。
```

### 递增操作符（++）

```++```的作用是将某个变量+1后再赋值给原变量。示例：

```JavaScript
let a = 1;
a++;
player.say(a);//显示2。
```

### 递减操作符（--）

```--```的作用是将某个变量-1后再赋值给原变量。示例：

```JavaScript
let a = 8;
a--;
player.say(7);//显示2。
```

### 取非操作符（!）

```!```的作用是取一个布尔变量的相反逻辑。示例：

```JavaScript
let a = true;
let b = !a;
player.say(b);//显示false。
```

```JavaScript
let a = false;
let b = !a;
player.say(b);//显示true。
```

### 比较操作符：相等（==）

```==```的作用是判断两个量是否相等。示例：

```JavaScript
let a = 1+1;
let b = 2;
let c = (a == b);
player.say(c);//显示true。这里c被赋了一个布尔值，表示a和b是否相等。
```

### 比较操作符：大小（><）

```>```和```<```的作用是判断两个量的大小。示例：

```JavaScript
let m = (3 + 3) > 7;
player.say(m);//显示false。
```

```JavaScript
let m = (3 + 3) < 7;
player.say(m);//显示true。
```

此外，还有```>=```表示“大于或等于”，```<=```表示“小于或等于”。

### 下标操作符：（[]）

```[]```用于取一个数组的其中元素。```[0]```是数组的开始。示例：

```JavaScript
let arr = [1,2,4,8,16,32];
let b = arr[0];//b的值为1.
let c = arr[2];//b的值为4，即为数组第三项，注意这里取值的时候是从0开始的，所以2代表第三项。
```

我们可以用这个操作符改变数组里的值，例如：

```JavaScript
let arr = [1,2,4,8,16,32];
arr[2] = 3;
player.say(arr[2]);//显示3。这个数组已经变成了[1,2,3,8,16,32]。
```

这个操作符的一些其它用法将在后面再说。

### 操作符的优先级

我们有时候需要进行连续的四则运算，例如```1-2+3*4/5```。这时，我们需要注意，操作符之间是有优先级的。优先级相同的操作符将按从左到右依次计算，优先级高的操作符将优先进行计算。

```JavaScript
let a = 1 + 4 * 3 / 2 + 3;
player.say(a);//显示10。
```

乘与除的优先级高于加和减的优先级。

可以用括号```()```改变运算的优先级。括号中的表达式将优先进行计算。

```JavaScript
let a = (1 + 4) * 3 / (2 + 3);
player.say(a);//显示3。
```

当然，JavaScript有很多操作符，这里介绍的只是最常用的。如果后面你并不清楚某个操作符的优先级，你可以一律使用括号将你认为应该优先计算的部分括起来。

参考资料：[JavaScript中的优先级](https://www.yzktw.com.cn/post/1600423.html)。